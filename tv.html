<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minha TV Ao Vivo</title>
  <!-- Layout simples: fonte grande, alto contraste e navega√ß√£o por controle remoto/teclas -->
  <style>
    :root {
      --bg: #0b0f14;
      --card: #131a22;
      --text: #eef2f6;
      --muted: #91a4b7;
      --accent: #2eaadc;
      --accent-2: #19c37d;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }
    .app {
      display: grid;
      grid-template-columns: 360px 1fr;
      grid-template-rows: auto 1fr auto;
      gap: 16px;
      height: 100vh;
      padding: 16px;
    }
    header, footer {
      grid-column: 1 / -1;
      background: var(--card);
      border-radius: 16px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 16px rgba(0,0,0,.3);
    }
    header h1 { font-size: 20px; margin: 0; letter-spacing: 0.5px; }
    header .hint { font-size: 14px; color: var(--muted); }

    .sidebar {
      background: var(--card);
      border-radius: 16px;
      padding: 12px;
      display: flex; flex-direction: column; gap: 12px;
    }
    .search {
      display: flex; gap: 8px;
    }
    input, button, .btn {
      font-size: 16px; border: none; outline: none;
      border-radius: 12px; padding: 10px 12px;
    }
    input { background: #0f1620; color: var(--text); width: 100%; }
    .btn { background: #15212c; color: var(--text); cursor: pointer; }
    .btn.primary { background: var(--accent); color: #00131b; font-weight: 700; }
    .btn.success { background: var(--accent-2); color: #00150d; font-weight: 700; }

    .channels { list-style: none; padding: 0; margin: 0; overflow: auto; flex: 1; }
    .channel { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; padding: 10px; border-radius: 12px; }
    .channel:focus { outline: 3px solid var(--accent); }
    .channel.active { background: rgba(46,170,220,.15); }
    .name { font-size: 16px; font-weight: 700; }
    .meta { font-size: 12px; color: var(--muted); word-break: break-all; }
    .row { display: flex; gap: 8px; }

    .player {
      background: #000; border-radius: 16px; padding: 8px; display: grid; place-items: center;
    }
    video { width: 100%; height: 100%; border-radius: 12px; background: #000; }

    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .pill { font-size: 14px; padding: 6px 10px; border-radius: 999px; background: #0f1620; color: var(--muted); }

    @media (max-width: 1024px) {
      .app { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr auto; }
      .sidebar { order: 2; }
      .player { order: 3; min-height: 40vh; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Minha TV Ao Vivo</h1>
      <div class="hint">Controles: ‚Üë/‚Üì troca canal ‚Ä¢ Enter reproduz ‚Ä¢ Back/ESC para parar</div>
    </header>

    <aside class="sidebar" aria-label="Lista de canais">
      <div class="row">
        <button class="btn success" id="btnPlay">‚ñ∂Ô∏è Reproduzir</button>
        <button class="btn" id="btnStop">‚èπÔ∏è Parar</button>
        <button class="btn" id="btnFull">‚õ∂ Tela cheia</button>
      </div>

      <div class="search">
        <input id="filter" placeholder="Pesquisar canal..." />
        <button class="btn" id="btnClear">Limpar</button>
      </div>

      <ul class="channels" id="channels" tabindex="0" aria-live="polite"></ul>

      <div class="row">
        <button class="btn" id="btnAdd">Ôºã Adicionar</button>
        <button class="btn" id="btnImport">üìÇ Importar M3U</button>
        <button class="btn" id="btnSave">üíæ Salvar</button>
        <button class="btn" id="btnReset">üóëÔ∏è Limpar tudo</button>
      </div>
    </aside>

    <main class="player">
      <video id="video" preload="none" controls playsinline></video>
      <div class="controls">
        <span class="pill" id="status">Pronto</span>
        <span class="pill" id="info"></span>
      </div>
    </main>

    <footer>
      <div>üí° Dica: voc√™ pode importar uma lista <strong>.m3u</strong> com URLs HLS (.m3u8).</div>
      <div>
        <button class="btn primary" id="btnShare">Compartilhar/Instalar</button>
      </div>
    </footer>
  </div>

  <!-- hls.js: para tocar HLS (.m3u8) em navegadores que n√£o suportam nativamente -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <script>
    // --- Estado ---
    const el = (id) => document.getElementById(id);
    const video = el('video');
    const listEl = el('channels');
    const statusEl = el('status');
    const infoEl = el('info');

    let hls; // inst√¢ncia do hls.js
    let channels = [];
    let selectedIndex = 0;

    // Exemplos (legais) de streams de teste
    const DEFAULT_CHANNELS = [
      { name: 'Demo | Mux Test', url: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8' },
      { name: 'Demo | Big Buck Bunny', url: 'https://test-streams.mux.dev/bbb-abr/bbb.m3u8' }
    ];

    // Carregar do localStorage
    function loadChannels() {
      try {
        const saved = JSON.parse(localStorage.getItem('mytv_channels'));
        channels = Array.isArray(saved) && saved.length ? saved : DEFAULT_CHANNELS.slice();
      } catch { channels = DEFAULT_CHANNELS.slice(); }
    }

    function saveChannels() {
      localStorage.setItem('mytv_channels', JSON.stringify(channels));
      toast('Canais salvos no dispositivo');
    }

    function toast(msg) {
      statusEl.textContent = msg;
      clearTimeout(toast._t);
      toast._t = setTimeout(() => (statusEl.textContent = 'Pronto'), 2500);
    }

    function renderList() {
      const q = el('filter').value.trim().toLowerCase();
      listEl.innerHTML = '';
      channels
        .map((c, i) => ({...c, i}))
        .filter(c => !q || c.name.toLowerCase().includes(q) || c.url.toLowerCase().includes(q))
        .forEach(({name, url, i}) => {
          const li = document.createElement('li');
          li.className = 'channel' + (i === selectedIndex ? ' active' : '');
          li.tabIndex = 0;
          li.dataset.index = i;
          li.innerHTML = `
            <div>
              <div class="name">${escapeHtml(name)}</div>
              <div class="meta">${escapeHtml(url)}</div>
            </div>
            <div class="row">
              <button class="btn" data-action="play">‚ñ∂Ô∏è</button>
              <button class="btn" data-action="edit">‚úèÔ∏è</button>
              <button class="btn" data-action="del">üóëÔ∏è</button>
            </div>`;
          listEl.appendChild(li);
        });
      updateInfo();
    }

    function escapeHtml(s) { return s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    function select(index) {
      if (index < 0) index = channels.length - 1;
      if (index >= channels.length) index = 0;
      selectedIndex = index;
      renderList();
    }

    function play(index = selectedIndex) {
      if (!channels[index]) return;
      const { url, name } = channels[index];
      stop();
      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play().catch(()=>{}));
        hls.on(Hls.Events.ERROR, (_, data) => { toast('Erro HLS: ' + data?.details); });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url; video.play().catch(()=>{});
      } else {
        toast('Seu navegador/TV n√£o suporta HLS');
      }
      statusEl.textContent = 'Reproduzindo: ' + name;
      updateInfo();
    }

    function stop() {
      if (hls) { hls.destroy(); hls = null; }
      video.pause();
      video.removeAttribute('src');
      video.load();
      statusEl.textContent = 'Parado';
    }

    function updateInfo() {
      const c = channels[selectedIndex];
      infoEl.textContent = c ? `Canal ${selectedIndex+1}/${channels.length}: ${c.name}` : '';
    }

    function addChannel() {
      const name = prompt('Nome do canal:');
      if (!name) return;
      const url = prompt('URL HLS (.m3u8):');
      if (!url) return;
      channels.push({ name, url });
      select(channels.length - 1);
      toast('Canal adicionado');
    }

    function editChannel(i) {
      const ch = channels[i]; if (!ch) return;
      const name = prompt('Nome do canal:', ch.name) ?? ch.name;
      const url = prompt('URL HLS (.m3u8):', ch.url) ?? ch.url;
      channels[i] = { name, url };
      renderList();
      toast('Canal atualizado');
    }

    function delChannel(i) {
      if (!channels[i]) return;
      if (!confirm('Excluir este canal?')) return;
      channels.splice(i, 1);
      if (selectedIndex >= channels.length) selectedIndex = channels.length - 1;
      renderList();
      toast('Canal removido');
    }

    function clearAll() {
      if (!confirm('Remover todos os canais e voltar ao padr√£o?')) return;
      channels = DEFAULT_CHANNELS.slice();
      selectedIndex = 0;
      renderList();
      toast('Lista redefinida');
    }

    async function importM3U() {
      const filePicker = document.createElement('input');
      filePicker.type = 'file';
      filePicker.accept = '.m3u,.m3u8,.txt';
      filePicker.onchange = async () => {
        const file = filePicker.files?.[0]; if (!file) return;
        const text = await file.text();
        const parsed = parseM3U(text);
        if (parsed.length) {
          channels = parsed;
          selectedIndex = 0;
          renderList();
          toast('Lista M3U importada');
        } else {
          toast('N√£o foi poss√≠vel ler canais do arquivo');
        }
      }
      filePicker.click();
    }

    function parseM3U(text) {
      // Suporte simples a EXTINF + URL; ignora grupos e logos (pode ser estendido)
      const lines = text.split(/\r?\n/);
      const out = [];
      let currentName = '';
      for (let i=0;i<lines.length;i++) {
        const line = lines[i].trim();
        if (!line || line.startsWith('#EXTM3U')) continue;
        if (line.startsWith('#EXTINF')) {
          // #EXTINF:-1 tvg-id="" tvg-name="Name" group-title="Group", Display Name
          const comma = line.indexOf(',');
          currentName = comma >= 0 ? line.slice(comma+1).trim() : 'Canal';
        } else if (!line.startsWith('#')) {
          const url = line;
          const name = currentName || `Canal ${out.length+1}`;
          out.push({ name, url });
          currentName = '';
        }
      }
      return out;
    }

    function shareOrInstall() {
      // Compartilha a URL atual; em TVs Samsung, adicione como Favorito/Atalho pelo navegador da TV
      if (navigator.share) {
        navigator.share({ title: document.title, text: 'Abra esta p√°gina na sua TV Samsung', url: location.href }).catch(()=>{});
      } else {
        prompt('Copie o link desta p√°gina e abra na sua TV:', location.href);
      }
    }

    function goFull() {
      if (video.requestFullscreen) video.requestFullscreen();
      else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen();
    }

    // --- Eventos UI ---
    listEl.addEventListener('click', (e) => {
      const item = e.target.closest('.channel');
      if (!item) return;
      const i = Number(item.dataset.index);
      const action = e.target?.dataset?.action;
      if (action === 'play') play(i);
      else if (action === 'edit') editChannel(i);
      else if (action === 'del') delChannel(i);
      else { select(i); }
    });

    listEl.addEventListener('keydown', (e) => {
      // Navega√ß√£o por setas/controle remoto
      if (['ArrowUp','ArrowDown','Enter'].includes(e.key)) e.preventDefault();
      if (e.key === 'ArrowUp') select(selectedIndex - 1);
      if (e.key === 'ArrowDown') select(selectedIndex + 1);
      if (e.key === 'Enter') play(selectedIndex);
    });

    el('btnPlay').onclick = () => play();
    el('btnStop').onclick = () => stop();
    el('btnFull').onclick = () => goFull();
    el('btnAdd').onclick = () => addChannel();
    el('btnImport').onclick = () => importM3U();
    el('btnSave').onclick = () => saveChannels();
    el('btnReset').onclick = () => clearAll();
    el('btnShare').onclick = () => shareOrInstall();
    el('btnClear').onclick = () => { el('filter').value = ''; renderList(); };
    el('filter').oninput = () => renderList();

    // Inicializa
    loadChannels();
    renderList();
    listEl.focus();

    // Pausa ao sair da aba (TVs √†s vezes minimizam)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) video.pause();
    });
  </script>
</body>
</html>
